<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itsme.letitgo.company.scout.model.mapper.CompanyScoutMapper">
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.MainScoutListingDTO" id="mainScoutResultMap">
		<id property="resumeNo" column="RESUME_NO"/>
		<result property="memNo" column="MEM_NO"/>
		<result property="carNo" column="CAR_NO"/>
		<result property="skillNo" column="SKILLS_NO"/>
		
		<association property="memberDTO" resultMap="mainScoutMemberDTO"/>
		<association property="resumeDTO" resultMap="mainScoutResumeDTO"/>
<!-- 		<collection property="carHistoryDTO" resultMap="mainScoutCarHistoryDTO"/> -->
			
	</resultMap>
	
		<resultMap type="com.itsme.letitgo.company.info.model.dto.CompanyTestDTO" id="mainScoutMemberDTO">
			<id property="memNO" column="MEM_NO"/>
			<result property="memId" column="MEM_ID"/>
			<result property="memPwd" column="MEM_PWD"/>
			<result property="memName" column="MEM_NAME"/>
			<result property="memEmail" column="MEM_EMAIL"/>
			<result property="memPhone" column="MEM_PHONE"/>
			<result property="memKinds" column="MEM_KINDS"/>
			<result property="enrollDate" column="MEM_ENROLL_DATE"/>
			<result property="entYn" column="MEM_ENT_YN"/>
			<result property="entDate" column="MEM_ENT_DATE"/>
			<result property="memEntNo" column="MEM_ENT_NO"/>
		</resultMap>
		
		<resultMap type="com.itsme.letitgo.personal.resume.model.dto.ResumeDTO" id="mainScoutResumeDTO">
			<id property="resumeNo" column="RESUME_NO"/>
			<result property="inMemNo" column="IN_MEM_NO"/>
			<result property="resumeWriteDate" column="RESUME_WRITE_DATE"/>
			<result property="resumeScoutStatus" column="RESUME_SCOUT_STATUS"/>
			<result property="jobNo" column="JOB_NO"/>
			<result property="resumeTitle" column="RESUME_TITLE"/>
		</resultMap>	
		
		<resultMap type="com.itsme.letitgo.company.scout.model.dto.CompanyCareerHistoryDTO" id="mainScoutCarHistoryDTO">
			<id property="carNo" column="CAR_NO"/>
			<result property="carComName" column="CAR_COM_NAME"/>
			<result property="carHireDate" column="CAR_HIRE_DATE"/>
			<result property="carEntDate" column="CAR_ENT_DATE"/>
			<result property="carStatus" column="CAR_STATUS"/>
			<result property="carDeptName" column="CAR_DEPT_NAME"/>
			<result property="carJobName" column="CAR_JOB_NAME"/>
			<result property="projectName" column="PROJECT_NAME"/>
			<result property="projectStartDate" column="PROJECT_START_DATE"/>
			<result property="projectEndDate" column="PROJECT_END_DATE"/>
			<result property="projectContent" column="PROJECT_CONTENT"/>
			<result property="carWorkField" column="CAR_WORK_FIELD"/>
			<result property="jobNo" column="JOB_NO"/>
			<result property="resumeNo" column="RESUME_NO"/>
			
			<association property="resumeNo" resultMap="mainScoutResumeDTO"/>
		</resultMap>
		
		<resultMap type="com.itsme.letitgo.personal.resume.model.dto.HoldingAndSkillsDTO" id="mainScoutHoldingSkillsDTO">
			<id property="resumeNo" column="RESUME_NO"/>
			<result property="skillsNo" column="SKILLS_NO"/>
			
			<association property="skillsAndCategory" resultMap="mainScoutSkillsAndCategotyDTO"/>
			
		</resultMap>	
		
			<resultMap type="com.itsme.letitgo.personal.resume.model.dto.SkillsAndCategoryDTO" id="mainScoutSkillsAndCategotyDTO">	
				<id property="skillsNo" column="SKILLS_NO"/>
				<result property="skillsName" column="SKILLS_NAME"/>
				<result property="categoryNo" column="CATEGORY_NO"/>
				
			</resultMap>		
			
<!-- 		간단열람          -->
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.BrosweSimplelDTO" id="simpleBrowse">
		<id property="resumeNo" column="RESUME_NO"/>
		<result property="inMemNo" column="IN_MEM_NO"/>
		<result property="resumeWriteDate" column="RESUME_WRITE_DATE"/>
		<result property="resumeScoutStatus" column="RESUME_SCOUT_STATUS"/>
		<result property="jobNo" column="JOB_NO"/>
		<result property="resumeTitle" column="RESUME_TITLE"/>
		
		<collection property="memDTO" resultMap="candiMemResultMap"/>
		<collection property="holdingAndSkillsDTO" resultMap="holdingSkillsResultMap" />
		<collection property="jobFieldDTO" resultMap="ScoutjobResultMap"/>
		<collection property="companyCareerHistoryDTO" resultMap="careeaHistoryResultMap"/>
<!-- 		<collection property="candidateDibsDTO" resultMap="candiDibsResultMap" /> -->
<!-- 		<collection property="resumeReadingHistoryDTO" resultMap="readingHistoryResultMap"/> -->
<!-- 		<collection property="readingUsageHistoryDTO" resultMap="usageHistoryResultMap" /> -->
	</resultMap>
		
	<resultMap type="com.itsme.letitgo.company.info.model.dto.CompanyTestDTO" id="candiMemResultMap">
		<id property="memNO" column="MEM_NO"/>
		<result property="memId" column="MEM_ID"/>
		<result property="memPwd" column="MEM_PWD"/>
		<result property="memName" column="MEM_NAME"/>
		<result property="memEmail" column="MEM_EMAIL"/>
		<result property="memPhone" column="MEM_PHONE"/>
		<result property="memKinds" column="MEM_KINDS"/>
		<result property="enrollDate" column="MEM_ENROLL_DATE"/>
		<result property="entYn" column="MEM_ENT_YN"/>
		<result property="entDate" column="MEM_ENT_DATE"/>
		<result property="memEntNo" column="MEM_ENT_NO"/>
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.personal.resume.model.dto.HoldingAndSkillsDTO" id="holdingSkillsResultMap">
			<id property="resumeNo" column="RESUME_NO"/>
			<result property="skillsNo" column="SKILLS_NO"/>
			
			<association property="skillsAndCategory" resultMap="SkillsNameResultMap"/>
	</resultMap>	
		
		<resultMap type="com.itsme.letitgo.personal.resume.model.dto.SkillsAndCategoryDTO" id="SkillsNameResultMap">	
			<id property="skillsNo" column="SKILLS_NO"/>
			<result property="skillsName" column="SKILLS_NAME"/>
			<result property="categoryNo" column="CATEGORY_NO"/>
		</resultMap>	
	
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.CompanyJobFieldDTO" id="ScoutjobResultMap">
			<id property="jobNo" column="JOB_NO"/>
			<result property="jobName" column="JOB_NAME"/>
	</resultMap>	
	
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.CompanyCareerHistoryDTO" id="careeaHistoryResultMap">
		<id property="carNo" column="CAR_NO"/>
		<result property="carComName" column="CAR_COM_NAME"/> 
		<result property="carHireDate" column="CAR_HIRE_DATE"/> 
		<result property="carEntDate" column="CAR_ENT_DATE"/> 
		<result property="carStatus" column="CAR_STATUS"/> 
		<result property="carDeptName" column="CAR_DEPT_NAME"/> 
		<result property="carJobName" column="CAR_JOB_NAME"/> 
		<result property="carWorkField" column="CAR_WORK_FIELD"/> 
		<result property="projectName" column="PROJECT_NAME"/> 
		<result property="projectStartDate" column="PROJECT_START_DATE"/> 
		<result property="projectEndDate" column="PROJECT_END_DATE"/> 
		<result property="projectContent" column="PROJECT_CONTENT"/> 
		<result property="jobNo" column="JOB_NO"/> 
		<result property="resumeNo" column="RESUME_NO"/> 
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.CandidateDibsDTO" id="candiDibsResultMap">
		<id property="resumeNo" column="RESUME_NO"/>
		<result property="coMemNo" column="CO_MEM_NO"/>
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.ResumeReadingHistoryDTO" id="readingHistoryResultMap">
		<id property="resumeBrowseNo" column="RESUME_BROWSE_NO"/>
		<result property="coMemNo" column="CO_MEM_NO"/>
		<result property="resumeNo" column="RESUME_NO"/>
		<result property="resumeBrowseDate" column="RESUME_BROWSE_DATE"/>
		<result property="resumeBrowseKinds" column="RESUME_BROWSE_KINDS"/>
	</resultMap>
	<resultMap type="com.itsme.letitgo.company.scout.model.dto.ReadingUsageHistoryDTO" id="usageHistoryResultMap">
		<id property="resumeNo" column="RESUME_NO"/>
		<result property="payNo" column="PAY_NO"/>
		<result property="coMemNo" column="CO_MEM_NO"/>
		<result property="productUseDate" column="PRODUCT_USE_DATE"/>
	</resultMap>	
			
		
		<select id="companySelectAllScout" resultMap="mainScoutResultMap">
		SELECT
			   M.MEM_NAME
		     , R.RESUME_NO
		FROM TBL_MEMBER M
		JOIN TBL_RESUME R ON (R.IN_MEM_NO = M.MEM_NO )
        WHERE RESUME_SCOUT_STATUS = 'Y'
        
		</select>
		<select id="companyScoutSkills" resultMap="mainScoutHoldingSkillsDTO">
		SELECT
                RS.RESUME_NO
		 	  , LISTAGG(S.SKILLS_NAME,',') WITHIN GROUP(ORDER BY S.SKILLS_NAME) as SKILLS_NAME
		  FROM TBL_RESUME_HOLDING_SKILLS RS
          JOIN TBL_SKILLS S ON (S.SKILLS_NO = RS.SKILLS_NO)
          GROUP BY RS.RESUME_NO
		</select>
		<select id="companyScoutCareea" resultType="HashMap">
			
		 SELECT
			     R.RESUME_NO
               , SUM( ROUND(ABS(MONTHS_BETWEEN(CR.CAR_HIRE_DATE,CR.CAR_ENT_DATE)),0)) as 경력
		    FROM TBL_CAREER_HISTORY CR
		    JOIN TBL_RESUME R ON (R.RESUME_NO = CR.RESUME_NO)
        GROUP BY CR.RESUME_NO
		</select>
		
		
<!-- 간단열람 -->		
		<select id="browseSelectInfo" resultMap="simpleBrowse">
			SELECT
			        M.MEM_NAME
			      , JF.JOB_NAME
				  , CH.CAR_COM_NAME
			      , CH.CAR_HIRE_DATE
			      , CH.CAR_ENT_DATE
			      , CH.CAR_STATUS
			      , CH.CAR_DEPT_NAME
			      , CH.CAR_JOB_NAME
			      , CH.PROJECT_NAME
			      , CH.PROJECT_START_DATE
			      , CH.PROJECT_END_DATE
			      , CH.PROJECT_CONTENT
			      , CH.CAR_WORK_FIELD
		      FROM TBL_RESUME R
			  JOIN TBL_MEMBER M ON (M.MEM_NO = R.IN_MEM_NO)
			  JOIN TBL_CAREER_HISTORY CH ON (R.RESUME_NO = CH.RESUME_NO)
			  JOIN TBL_JOB_FIELD JF ON (R.JOB_NO = JF.JOB_NO)
			  WHERE R.RESUME_NO = #{onClickResumeNo}
		</select>
</mapper>
