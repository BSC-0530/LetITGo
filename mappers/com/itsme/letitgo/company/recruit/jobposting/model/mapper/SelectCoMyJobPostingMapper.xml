<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper">
	<resultMap type="com.itsme.letitgo.company.recruit.jobposting.model.dto.SelectCoMyJobPostingDTO" id="resultMyJobPosting">	
		<id property="jobPostNo" column="JOB_POST_NO"/>
		<result property="jobPostTitle" column="JOB_POST_TITLE" javaType="string"/>
		<result property="jobPostMinExperience" column="JOB_POST_MIN_EXPERIENCE"/>
		<result property="jobPostMaxExperience" column="JOB_POST_MAX_EXPERIENCE"/>
		<result property="jobPostEnrollDate" column="JOB_POST_ENROLL_DATE"/>
		<result property="jobPostDeadline" column="JOB_POST_DEADLINE"/>
		<result property="jobPostKinds" column="JOB_POST_KINDS"/>
		<result property="exposureUseCheck" column="EXPOSURE_USE_CHECK"/>
		<result property="jobPostContents" column="JOB_POST_CONTENTS"/>
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.company.recruit.jobposting.model.dto.JpJobFieldDTO" id="resultJobField">
		<id property="jobNo" column="JOB_NO"/>
		<result property="jobName" column="JOB_NAME"/>
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.company.recruit.jobposting.model.dto.JpSkillsDTO" id="resultSkills" >
		<result property="skillsNo" column="SKILLS_NO"/>
		<result property="jobPostNo" column="JOB_POST_NO"/>
		<result property="skillsName" column="SKILLS_NAME"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
	</resultMap>
	
	<resultMap type="com.itsme.letitgo.company.recruit.jobposting.model.dto.JpSkillsCategoryDTO" id="resultSkillsCategory">
		<id property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
		<result property="categoryUpperNo" column="CATEGORY_UPPER_NO"/>
	</resultMap>
	
	
	
	<select id="selectCoMyJobPosting" parameterType="com.itsme.letitgo.company.recruit.jobposting.model.dto.SelectCoMyJobPostingDTO" resultMap="resultMyJobPosting">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectCoMyJobPosting() */
	    	   JP.JOB_POST_NO
	    	 , JP.JOB_POST_TITLE
	    	 , JP.JOB_POST_MIN_EXPERIENCE
	    	 , JP.JOB_POST_MAX_EXPERIENCE
	    	 , JP.JOB_POST_ENROLL_DATE
	    	 , JP.JOB_POST_DEADLINE
	    	 , JP.JOB_POST_KINDS
	    	 , JP.EXPOSURE_USE_CHECK
	      FROM TBL_JOB_POSTING JP
	     WHERE JP.CO_MEM_NO = #{ coMemNo }
	</select>
	
	<select id="selectRecruitingMyJobPosting" parameterType="com.itsme.letitgo.company.recruit.jobposting.model.dto.SelectCoMyJobPostingDTO" resultMap="resultMyJobPosting">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectRecruitingMyJobPosting() */
	    	   JP.JOB_POST_NO
	    	 , JP.JOB_POST_TITLE
	    	 , JP.JOB_POST_MIN_EXPERIENCE
	    	 , JP.JOB_POST_MAX_EXPERIENCE
	    	 , JP.JOB_POST_ENROLL_DATE
	    	 , JP.JOB_POST_DEADLINE
	    	 , JP.JOB_POST_KINDS
	    	 , JP.EXPOSURE_USE_CHECK
	      FROM TBL_JOB_POSTING JP
	     WHERE JP.CO_MEM_NO = #{ coMemNo }
	       AND JP.JOB_POST_KINDS = '승인된공고'
	</select>
	
	<select id="selectRequestMyJobPosting" parameterType="com.itsme.letitgo.company.recruit.jobposting.model.dto.SelectCoMyJobPostingDTO" resultMap="resultMyJobPosting">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectRequestMyJobPosting() */
	    	   JP.JOB_POST_NO
	    	 , JP.JOB_POST_TITLE
	    	 , JP.JOB_POST_MIN_EXPERIENCE
	    	 , JP.JOB_POST_MAX_EXPERIENCE
	    	 , JP.JOB_POST_ENROLL_DATE
	    	 , JP.JOB_POST_DEADLINE
	    	 , JP.JOB_POST_KINDS
	    	 , JP.EXPOSURE_USE_CHECK
	      FROM TBL_JOB_POSTING JP
	     WHERE JP.CO_MEM_NO = #{ coMemNo }
	       AND JP.JOB_POST_KINDS = '승인대기중인공고'
	</select>
	
	<select id="selectJobName" resultMap="resultJobField">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectJobName() */
			   JF.JOB_NO
			 , JF.JOB_NAME
		  FROM TBL_JOB_FIELD JF
	</select>
	
	<!-- 스킬 카테고리 하위에 스킬이 있는 경우에만 카테고리 조회 -->
	<select id="selectSkillsCategory" resultMap="resultSkillsCategory">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectSkillsCategory() */
			   DISTINCT SC.CATEGORY_NO
			 , SC.CATEGORY_NAME
			 , SC.CATEGORY_UPPER_NO
		  FROM TBL_SKILLS_CATEGORY SC
		  JOIN TBL_SKILLS S ON(SC.CATEGORY_NO = S.CATEGORY_NO)
	</select>
	
	<select id="selectSkills" resultMap="resultSkills">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectSkills() */
			   S.SKILLS_NO
			 , S.SKILLS_NAME
			 , S.CATEGORY_NO S
		  FROM TBL_SKILLS S
	</select>
	
	<!-- 채용공고에서 category선택시 skills 출력 -->
	<select id="selectSkillsFromCategory" parameterType="_int" resultMap="resultSkills">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#selectSkillsFromCategory() */
		  	   S.SKILLS_NO
		  	 , S.SKILLS_NAME
		  	 , S.CATEGORY_NO
		  FROM TBL_SKILLS S
		 WHERE S.CATEGORY_NO = #{ categoryNo }
	</select>
	
	
	<!-- 공고 등록/수정 입력한 값 insert 후 seq로 입력한 jobPostNo dto에 저장 -->
	<insert id="insertJobPosting" parameterType="com.itsme.letitgo.company.recruit.jobposting.model.dto.RequestJobPostingDTO">
		INSERT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#insertJobPosting() */
		  INTO TBL_JOB_POSTING JP
		(
		  JP.JOB_POST_NO
		, JP.CO_MEM_NO
		, JP.JOB_POST_TITLE
		, JP.JOB_NO
		, JP.JOB_POST_DEADLINE
		, JP.JOB_POST_CONTENTS
		, JP.JOB_POST_MIN_EXPERIENCE
		, JP.JOB_POST_MAX_EXPERIENCE
		)
		VALUES
		(
		  SEQ_JOB_POST_NO.NEXTVAL
		, #{ coMemNo }
		, #{ jobPostTitle }
		, #{ jobNo }
		, #{ jobPostDeadLine }
		, #{ jobPostContents }
		, #{ jobPostMinExperience }
		, #{ jobPostMaxExperience }
		
		)
		<selectKey keyColumn="JOB_POST_NO" keyProperty="jobPostNo" resultType="_int" order="AFTER">
	        SELECT 
	               SEQ_JOB_POST_NO.CURRVAL
	          FROM DUAL
        </selectKey>
	</insert>
	
	<!-- 공고 등록/수정 선택한 skills insert -->
	<insert id="insertSkills" parameterType="com.itsme.letitgo.personal.recruit.jobposting.model.dto.JpSkillsDTO">
		INSERT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#insertSkills() */
		  INTO TBL_JOB_POSTING_REQ_SKILLS RS
		(
		  RS.JOB_POST_NO
		, RS.SKILLS_NO
		)
		VALUES
		(
		  #{ jobPostNo }
		, #{ skillsNo }
		)
	</insert>
	
	<!-- 공고 등록 history에 insert -->
	<insert id="insertJobPostingAppHistory" parameterType="_int">
		INSERT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#insertjobPostingAppHistory() */
		  INTO TBL_JOB_POSTING_APP_HISTORY AH
		(
		  AH.JOB_POST_REQ_NO
		, AH.JOB_POST_REQ_DATE
		, AH.JOB_POST_REQ_KINDS
		, AH.JOB_POST_NO
		)
		VALUES
		(
		  SEQ_JOB_POST_REQ_NO.NEXTVAL
		, SYSDATE
		, '공고등록'
		, #{ jobPostNo }
		)
	</insert>
	
	<!-- 공고 수정시 정보 조회-->
	<select id="updateRecruit" parameterType="_int" resultMap="resultMyJobPosting">
		SELECT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#updateRecruit() */
		  	   JP.JOB_POST_NO
		  	 , JP.JOB_POST_TITLE
		  	 , JP.JOB_POST_MIN_EXPERIENCE
		  	 , JP.JOB_POST_MAX_EXPERIENCE
		  	 , JP.JOB_POST_DEADLINE
		  	 , JP.JOB_POST_CONTENTS
		  	 , JP.JOB_POST_KINDS
		  	 , JP.JOB_NO
		  	 , JOB_POST_ENROLL_DATE
		  FROM TBL_JOB_POSTING JP
		 WHERE JP.JOB_POST_NO = #{ jobPostNo }
	</select>

	
	<!-- 공고 수정 history에 insert -->
	<insert id="updateJobPostingAppHistory" parameterType="_int">
		INSERT /* com.itsme.letitgo.company.recruit.jobposting.model.mapper.SelectCoMyJobPostingMapper#insertjobPostingAppHistory() */
		  INTO TBL_JOB_POSTING_APP_HISTORY AH
		(
		  AH.JOB_POST_REQ_NO
		, AH.JOB_POST_REQ_DATE
		, AH.JOB_POST_REQ_KINDS
		, AH.JOB_POST_NO
		, AH.CHANGE_REQ_JOB_POST_NO
		)
		VALUES
		(
		  SEQ_JOB_POST_REQ_NO.NEXTVAL
		, SYSDATE
		, '공고수정'
		, #{ jobPostNo }
		, #{ updateJobPostNo }
		)
	</insert>
	





	
	
</mapper>